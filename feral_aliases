#!/bin/bash

###
# Variables for commonly needed info
###

#
# All variables must start with FERAL_ to avoid issues with potentially existing variables.
#

# the /dev/ of the user's drive -- might not map to ${HOME} directly
export FERAL_DRIVE=$(df -h ~ | grep -v grep | grep dev | awk '{print $1}')
# i.e. ext4 or zfs
export FERAL_FSTYPE=$(df -T ${FERAL_DRIVE} | awk '{print $2}' | grep -v Type)
# Avoiding magic URLS
export FERAL_ALIASES_URL="https://git.io/vsuVp"

###
# Functions
###

#
# All functions must start with FERAL_ to avoid issues with potentially existing variables.
#

function feral_iostat(){
	if [[ ! "${FERAL_FSTYPE}" == "ext4" ]]; then
		echo "Sorry, this command only works on ext4 drives."
	else	
		echo "Hit control-c to cancel this when you are done reviewing"
		echo "This tool measures how busy your hard drive is, as a percent of how busy it can be."
		echo "Seeing '100' frequently is a sign (but not proof) of a problem."
		iostat -x 5 -d ${FERAL_DRIVE} | awk '{print $14}'
	fi
}

function feral_update_aliases(){
	wget -O ~/.feral_aliases "${FERAL_ALIASES_URL}"
	. ~/.feral_aliases
}

function feral_add_to_bashrc () {
	if [[ $(grep "FERAL_ALIASES" -c ~/.bashrc) -eq "0" ]]; then
		echo "Adding these aliases to ~/.bashrc..."
		echo "### Do not modify this block by hand ###" >> ~/.bashrc
		echo "# import FERAL_ALIASES by default for all new shells" >> ~/.bashrc
		echo ". ~/.feral_aliases" >> ~/.bashrc
		echo "###/Do not modify this block by hand ###" >> ~/.bashrc
	fi
	if [[ $(grep "FERAL_ALIASES" -c ~/.bashrc) -gt "0" ]]; then
		echo "Feral aliases added this to ~/.bashrc!"
	fi
}

function feral_usage(){
	echo "This is just a stub for later"
}

###
# Aliases
###

#
# All aliases must start with FERAL_ to avoid issues with potentially existing variables.
#
